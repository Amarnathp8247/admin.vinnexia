import{Q as D,j as e,X as W,c as B,cF as A,a4 as M,r as v,cG as E,S as d,B as i,R as z,g as O,$ as k,a_ as F,T as t,ap as x,cH as P,e as Q,h as G,k as w}from"./index-Bjlp2vES.js";import{P as H}from"./Person-DVyFyRd8.js";import{S as N}from"./SupportAgent-CsGcM2Fr.js";import{A as X}from"./Avatar-TT7_qFMD.js";const _=D(e.jsx("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send");function U(){var S;const{state:p}=W(),m=p==null?void 0:p.ticketId,g=B(),{data:h,isLoading:l}=A({id:m}),r=h==null?void 0:h.data,{selectedTheme:R}=M(o=>o.themeMode),[u,f]=v.useState(""),[j,y]=v.useState(""),[I,{isLoading:C}]=E(),L=async o=>{var c,n;if(o.preventDefault(),!u.trim()){y("Reply message cannot be empty.");return}try{const a=await I({ticketId:m,message:u}).unwrap();a!=null&&a.status&&(y(""),g(w({open:!0,message:a==null?void 0:a.message,severity:"success"})),f(""))}catch(a){(c=a==null?void 0:a.data)!=null&&c.status||g(w({open:!0,message:((n=a==null?void 0:a.data)==null?void 0:n.message)||"Failed to submit. Please try again later.",severity:"error"}))}},s=R==="dark",b=s?"#1e1e1e":"#f5f5f5";return e.jsxs(d,{sx:{gap:"2rem",color:s?"white":"text.primary"},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(z,{title:"Back",placement:"bottom-end",children:e.jsx(O,{component:k,to:"/admin/tickets",sx:{color:s?"white":"inherit"},children:e.jsx(F,{})})}),e.jsx(t,{sx:{fontSize:"2rem",fontWeight:"700"},children:"Ticket Details"})]}),e.jsxs(d,{sx:{bgcolor:b,p:"1.5rem",borderRadius:"1rem",gap:"1.5rem",boxShadow:s?"none":1,border:s?"1px solid #333":"none"},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs(i,{children:[e.jsx(t,{variant:"overline",color:s?"gray":"text.secondary",children:"Subject"}),e.jsx(t,{variant:"h5",fontWeight:"bold",children:l?e.jsx(x,{width:"300px"}):r==null?void 0:r.subject})]}),e.jsx(P,{label:l?"...":r==null?void 0:r.status,color:(r==null?void 0:r.status)==="CLOSED"?"error":"success",variant:"filled",sx:{fontWeight:"bold",borderRadius:"6px"}})]}),e.jsxs(i,{sx:{display:"flex",gap:"4rem"},children:[e.jsxs(i,{children:[e.jsx(t,{variant:"overline",color:s?"gray":"text.secondary",children:"Created on"}),e.jsx(t,{fontWeight:"600",fontSize:"0.95rem",children:l?e.jsx(x,{width:"150px"}):new Date(r==null?void 0:r.createdAt).toLocaleString()})]}),e.jsxs(i,{children:[e.jsx(t,{variant:"overline",color:s?"gray":"text.secondary",children:"Closed on"}),e.jsx(t,{fontWeight:"600",fontSize:"0.95rem",children:l?e.jsx(x,{width:"150px"}):(r==null?void 0:r.status)==="CLOSED"?new Date(r==null?void 0:r.updatedAt).toLocaleString():"â€”"})]})]})]}),e.jsxs(i,{children:[e.jsx(t,{variant:"h6",fontWeight:"700",mb:"1rem",children:"Conversation"}),e.jsx(d,{spacing:3,children:((S=r==null?void 0:r.message)==null?void 0:S.length)>0&&(r==null?void 0:r.message).map((o,c)=>{const n=(o==null?void 0:o.sender)==="admin";return e.jsxs(d,{direction:n?"row-reverse":"row",alignItems:"flex-start",spacing:2,children:[e.jsx(X,{sx:{bgcolor:n?"secondary.main":"primary.main"},children:n?e.jsx(N,{}):e.jsx(H,{})}),e.jsxs(i,{sx:{display:"flex",flexDirection:"column",alignItems:n?"flex-end":"flex-start",maxWidth:"70%"},children:[e.jsx(i,{sx:{bgcolor:n?"#4caf50":s?"#333":"#e0e0e0",color:n||s?"white":"black",p:"1rem",borderRadius:"12px",borderTopRightRadius:n?"2px":"12px",borderTopLeftRadius:n?"12px":"2px",position:"relative"},children:e.jsx(t,{variant:"body1",children:l?e.jsx(x,{width:"200px"}):o==null?void 0:o.text})}),e.jsx(t,{variant:"caption",sx:{mt:.5,color:s?"gray":"text.secondary"},children:l?e.jsx(x,{width:"50px"}):new Date(o==null?void 0:o.time).toLocaleString()})]})]},c)})})]}),e.jsxs(d,{sx:{bgcolor:b,p:"1.5rem",borderRadius:"1rem",boxShadow:s?"none":1,border:s?"1px solid #333":"none"},component:"form",onSubmit:L,children:[e.jsx(t,{mb:"1rem",fontSize:"1.1rem",fontWeight:"bold",children:"Add Reply"}),e.jsx(Q,{name:"message",value:u,onChange:o=>f(o.target.value),multiline:!0,rows:4,placeholder:"Type your message here...",fullWidth:!0,sx:{backgroundColor:s?"#121212":"#ffffff",borderRadius:"8px","& .MuiOutlinedInput-root":{"& fieldset":{borderColor:s?"#444":"#ccc"},"&:hover fieldset":{borderColor:s?"#666":"#aaa"}},"& .MuiInputBase-input":{color:s?"white":"black"}}}),j&&e.jsx(t,{color:"error",mt:1,children:j}),e.jsx(i,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:e.jsx(G,{variant:"contained",disabled:C||(r==null?void 0:r.status)==="CLOSED",type:"submit",endIcon:e.jsx(_,{}),sx:{textTransform:"none",padding:"0.5rem 2rem",borderRadius:"20px",fontWeight:"bold",bgcolor:s?"#444":"primary.main","&:hover":{bgcolor:s?"#555":"primary.dark"}},children:"Send Reply"})})]})]})}export{U as default};
