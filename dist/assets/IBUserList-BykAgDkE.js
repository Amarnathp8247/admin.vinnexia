import{o as P,aC as A,c as N,r as M,b7 as U,a as R,b as D,b8 as w,j as n,S as B,T as l,B as L,I as _,h as v,k as j,at as $,X as C,$ as T,av as W,aw as q,aB as G}from"./index-BuLT-AS9.js";import{F as H}from"./FileDownload-Z7rQgJvD.js";import{u as S,w as V}from"./xlsx-D1NZSDnX.js";import{M as Q}from"./ModalComponent-CNxH8GAn.js";import{S as X}from"./SearchableSelector-DnYtu6tK.js";const J=P({marketingMemberId:A({required_error:"Marketing member is required"}).nullable().refine(e=>e!==null,{message:"Marketing member is required"})});function K({data:e}){var y;const a=e,s=N(),[t,o]=M.useState(""),i={marketingMemberId:null},{data:d,isLoading:u}=U({page:1,sizePerPage:10,search:t},{skip:t.length<3}),b=t.length>=3?((y=d==null?void 0:d.data)==null?void 0:y.usersList)||[]:[],{handleSubmit:f,reset:g,watch:h,setValue:x,formState:{errors:p}}=R({resolver:D(J),defaultValues:i}),[E,{isLoading:z}]=w(),F=async m=>{var k,I;try{const r=await E({...m,ibId:a}).unwrap();r!=null&&r.status&&(s(j({open:!0,message:r==null?void 0:r.message,severity:"success"})),g(i))}catch(r){(k=r==null?void 0:r.data)!=null&&k.status||s(j({open:!0,message:((I=r==null?void 0:r.data)==null?void 0:I.message)||"Failed to submit. Please try again later.",severity:"error"}))}};return n.jsxs(B,{component:"form",onSubmit:f(F),children:[n.jsx(l,{fontWeight:700,fontSize:"1.5rem",mb:"1.5rem",children:"Assign To"}),n.jsxs(L,{children:[n.jsx(_,{sx:{mb:".5rem"},children:"Select Marketing *"}),n.jsx(X,{width:"100%",items:b.map(m=>({value:m.id,name:`${m.name} (${m.email})`})),value:h("marketingMemberId"),onChange:m=>x("marketingMemberId",m,{shouldValidate:!0}),onSearchChange:m=>o(m),isLoading:u,shouldBeFullwidth:!0}),p.marketingMemberId&&n.jsx(l,{color:"error",fontSize:"14px",children:p.marketingMemberId.message})]}),n.jsx(v,{type:"submit",variant:"contained",disabled:z,sx:{textTransform:"capitalize",boxShadow:"none",color:"white",mt:"1.5rem",alignSelf:"self-start","&:hover":{boxShadow:"none"}},children:"Assign"})]})}const c=$(),O=[c.accessor("name",{header:"Name",Cell:({row:e})=>{var t;const{pathname:a}=C(),s=(t=e==null?void 0:e.original)==null?void 0:t.id;return n.jsx(l,{component:T,to:`/admin/IBManagement/IBUserDetails/${s}`,state:{pathname:a},sx:{color:"inherit"},children:e.original.name})}}),c.accessor("email",{header:"Email",Cell:({row:e})=>{var t;const{pathname:a}=C(),s=(t=e==null?void 0:e.original)==null?void 0:t.id;return n.jsx(l,{component:T,to:`/admin/IBManagement/IBUserDetails/${s}`,state:{pathname:a},sx:{color:"inherit"},children:e.original.email})}}),c.accessor("mobile",{header:"Phone"}),c.accessor("country",{header:"Country"}),c.display({id:"parentName",header:"Parent Name",Cell:({row:e})=>{var s,t;const a=(t=(s=e==null?void 0:e.original)==null?void 0:s.parent)==null?void 0:t.name;return n.jsx(l,{component:a?"p":"em",sx:{fontSize:!a&&"12px"},children:a||"Empty"})}}),c.display({id:"parentEmail",header:"Parent Email",Cell:({row:e})=>{var s,t;const a=(t=(s=e==null?void 0:e.original)==null?void 0:s.parent)==null?void 0:t.email;return n.jsx(l,{component:a?"p":"em",sx:{fontSize:!a&&"12px"},children:a||"Empty"})}}),c.display({id:"parantUserName",header:"Parant User Name",Cell:({row:e})=>{var s,t;const a=(t=(s=e==null?void 0:e.original)==null?void 0:s.parent)==null?void 0:t.userName;return n.jsx(l,{component:a?"p":"em",sx:{fontSize:!a&&"12px"},children:a||"Empty"})}}),c.accessor("remark",{header:"Remark",Cell:({row:e})=>e.original.remark?n.jsx(l,{sx:{fontSize:"14px"},children:e.original.remark}):n.jsx(l,{sx:{fontSize:"13px"},children:"Not - available"})}),c.display({id:"action",header:"Action",Cell:({row:e})=>{const a=e.original.id;return n.jsx(Q,{Content:K,btnName:"Assign To",contentData:a,modalWidth:{xs:"95%",sm:600},btnSx:{textTransform:"none",color:"white",fontSize:"0.7rem",px:"8px",py:"4px"}})}})],Y=e=>{const a=e.getRowModel().rows.map(o=>{const i=o.original;return{"User Name":i.name,Email:i.email,CountryCode:i.countryCode,Phone:i.mobile,Country:i.country}}),s=S.json_to_sheet(a),t=S.book_new();S.book_append_sheet(t,s,"MT5 Users"),V(t,"IBuserList.xlsx")};function se(){var h,x,p;const[e,a]=M.useState({pageIndex:0,pageSize:10}),[s,t]=M.useState(""),{data:o,isLoading:i,isError:d,error:u}=W({page:e.pageIndex+1,sizePerPage:e.pageSize,isIb:!0,search:s}),b=(h=u==null?void 0:u.data)==null?void 0:h.message,f=((x=o==null?void 0:o.data)==null?void 0:x.usersList)||[],g=q({columns:O,data:f,enableColumnFilters:!1,enableSorting:!1,enableColumnActions:!1,manualPagination:!0,manualFiltering:!0,rowCount:((p=o==null?void 0:o.data)==null?void 0:p.totalRecords)||0,state:{pagination:e,isLoading:i,showAlertBanner:d},initialState:{showGlobalFilter:!0},onPaginationChange:a,onGlobalFilterChange:t,columnFilterDisplayMode:"popover",paginationDisplayMode:"pages",positionToolbarAlertBanner:"bottom",muiToolbarAlertBannerProps:d?{color:"error",children:b||"Error loading IB User List."}:void 0,renderTopToolbarCustomActions:()=>n.jsx(L,{sx:{display:"flex",gap:"16px",padding:"8px",flexWrap:"wrap"},children:n.jsx(v,{variant:"contained",onClick:()=>Y(g),startIcon:n.jsx(H,{sx:{color:"white"}}),sx:{textTransform:"none",color:"white",boxShadow:"none","&:hover":{boxShadow:"none"}},children:"Excel"})})});return n.jsxs(n.Fragment,{children:[n.jsx(l,{variant:"h5",fontWeight:"700",fontSize:"1.8rem",mb:"2rem",children:"IB User List"}),n.jsx(B,{sx:{marginTop:"2rem",borderRadius:"1.2rem",overflow:"hidden"},children:n.jsx(G,{table:g})})]})}export{se as default};
