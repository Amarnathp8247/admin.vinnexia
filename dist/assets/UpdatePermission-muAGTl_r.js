import{bR as D,bS as F,X as W,c as G,a4 as V,bT as z,a as K,r as x,bU as H,j as e,ar as Q,B as f,R as X,g as _,$,a_ as q,T as b,S as R,h as g,aF as J,G as A,bV as Y,ax as Z,ay as ee,b as se,k as I}from"./index-Bjlp2vES.js";const te=D(F()),re=o=>o.split("-").map(c=>c.charAt(0).toUpperCase()+c.slice(1).toLowerCase()).join(" "),ae=o=>o&&o!=="Misc"?o.charAt(0).toUpperCase()+o.slice(1).toLowerCase():"Misc";function ie({id:o}){const{state:c}=W(),p=o||(c==null?void 0:c.marketingId),k=c==null?void 0:c.marketingMemberName,j=G(),{selectedTheme:L}=V(t=>t.themeMode),{data:h,isLoading:O,refetch:M}=z({id:p},{skip:!p}),d=(h==null?void 0:h.data)||null,{control:w,handleSubmit:P,reset:m,getValues:y,setValue:U,formState:{isSubmitting:S}}=K({resolver:se(te),defaultValues:{}}),T=x.useMemo(()=>{const t={};return d&&Object.entries(d).forEach(([s,a])=>{t[s]=!!a}),t},[d]),C=x.useMemo(()=>{const t={},s=(r,i)=>{t[r]||(t[r]=[]),t[r].push(i)};Object.keys(T).forEach(r=>{const i=r.toUpperCase();if(i.includes("PASSWORD")){s("USER",r);return}if(i.includes("TRANSACTION")||i.includes("DEPOSIT")||i.includes("WITHDRAW")||i.includes("WALLET")||i.includes("FUND")||i.includes("TRANSFER")){s("TRANSACTION",r);return}if(i.includes("REFERRAL")||i.startsWith("IB-")){s("IB",r);return}const l=r.indexOf("-"),u=l===-1?"Misc":r.slice(0,l).toUpperCase();s(u,r)});let a=Object.entries(t).map(([r,i])=>({groupKey:r,displayName:ae(r),permissions:i.map(l=>({name:l,fieldName:re(l)}))}));const n=["MARKETING","USER","IB","META","SUPPORT","TRANSACTION","MISC","Misc"];return a.sort((r,i)=>{const l=n.indexOf(r.groupKey),u=n.indexOf(i.groupKey);return l===-1&&u===-1?r.groupKey.localeCompare(i.groupKey):l===-1?1:u===-1?-1:l-u}),a},[T]);x.useEffect(()=>{if(d){const t=Object.entries(d).reduce((s,[a,n])=>(s[a]=!!n,s),{});m(t)}else m({})},[d,m]);const[v,{isLoading:E}]=H(),B=async t=>{var s;try{const a={...t,userId:p},n=await v(a).unwrap();n!=null&&n.status&&(j(I({open:!0,message:n==null?void 0:n.message,severity:"success"})),await M(),m(y()))}catch(a){j(I({open:!0,message:((s=a==null?void 0:a.data)==null?void 0:s.message)||"Failed to submit. Please try again later.",severity:"error"}))}},N=(t,s)=>{const n={...y()};t.forEach(r=>{n[r]=!!s,U(r,!!s,{shouldValidate:!1,shouldDirty:!0})}),m(n,{keepDirty:!0,keepTouched:!0,keepErrors:!0})};return e.jsx(e.Fragment,{children:O?e.jsx(Q,{}):e.jsxs(e.Fragment,{children:[e.jsxs(f,{sx:{mb:"2rem",display:"flex",alignItems:"center",gap:"15px"},children:[!o&&e.jsx(X,{title:"Back",placement:"bottom-end",children:e.jsx(_,{component:$,to:"/admin/marketing/marketingList",children:e.jsx(q,{})})}),e.jsxs(b,{sx:{fontWeight:700,py:"20px",fontSize:o?"1.2rem":"2rem",color:"text.primary"},children:["Edit Permissions :- ",k]})]}),e.jsxs(f,{sx:{p:3,borderRadius:"1rem",bgcolor:L==="dark"?"#272727":"#e9e6e6"},component:"form",onSubmit:P(B),children:[C.length===0&&e.jsx(b,{sx:{mb:2},children:"No permissions found for this user."}),C.map(t=>e.jsxs(f,{sx:{mb:4},children:[e.jsxs(R,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:1},children:[e.jsx(b,{variant:"h6",children:t.displayName}),e.jsxs(R,{direction:"row",spacing:1,children:[e.jsx(g,{size:"small",variant:"outlined",onClick:()=>N(t.permissions.map(s=>s.name),!0),children:"Select all"}),e.jsx(g,{size:"small",variant:"outlined",onClick:()=>N(t.permissions.map(s=>s.name),!1),children:"Clear all"})]})]}),e.jsx(J,{sx:{mb:2,borderWidth:"2px"}}),e.jsx(A,{container:!0,spacing:2,children:t.permissions.map(s=>e.jsx(A,{item:!0,xs:12,sm:6,md:3,children:e.jsx(Y,{name:s.name,control:w,render:({field:a})=>e.jsx(Z,{control:e.jsx(ee,{...a,checked:!!a.value,onChange:n=>a.onChange(n.target.checked),sx:{"&.Mui-checked":{color:"primary.main"}}}),label:s.fieldName})})},s.name))})]},t.groupKey)),e.jsx(g,{variant:"contained",type:"submit",disabled:E||S,sx:{textTransform:"capitalize",boxShadow:"none",color:"white",alignSelf:"self-start","&:hover":{boxShadow:"none"}},children:E||S?"Updating...":"Update"})]})]})})}export{ie as default};
