import{av as D,j as s,T as f,aX as U,bx as B,c as k,aY as E,by as F,S,h as M,i as v,U as N,r as R,ay as A,aI as P,aD as O,B as _}from"./index-oaA_Ltxz.js";import{F as z}from"./FileDownload-Cn3EXkSJ.js";import{u as T,w as H}from"./xlsx-D1NZSDnX.js";import{M as G}from"./ModalComponent-DTq5tozF.js";import{O as W}from"./OverrideCommissionModal-DadzeG59.js";const r=D(),Y=({ibId:u,planId:d})=>[r.accessor("name",{header:"Name"}),r.accessor("userName",{header:"User Name"}),r.display({id:"referralUserName",header:"Referral user name",Cell:({row:e})=>{var i,t;return s.jsx(f,{children:(t=(i=e==null?void 0:e.original)==null?void 0:i.referralUser)==null?void 0:t.userName})}}),r.display({id:"referralUserEmail",header:"Referral user email",Cell:({row:e})=>{var i,t;return s.jsx(f,{children:(t=(i=e==null?void 0:e.original)==null?void 0:i.referralUser)==null?void 0:t.email})}}),r.accessor("level",{header:"Level"}),r.accessor("isSubIb",{header:"Sub IB",Cell:({row:e})=>{var i,t;return s.jsx(f,{sx:{color:(i=e==null?void 0:e.original)!=null&&i.isSubIb?"green":"red"},children:(t=e==null?void 0:e.original)!=null&&t.isSubIb?"Yes":"No"})}}),r.accessor("date",{header:"Registration Date",Cell:({row:e})=>s.jsx(f,{children:new Date(e.original.date).toLocaleString()})}),r.display({id:"action",header:"Action",Cell:({row:e})=>{var l,h,b;const{id:i}=U(),t=(l=e==null?void 0:e.original)==null?void 0:l.id,{refetch:y}=B({ibId:i}),L=(h=e==null?void 0:e.original)!=null&&h.isSubIb?"false":"true",m=k(),[I,{isLoading:p}]=E(),j=async()=>{var n,o;try{const a=await I({userId:t,isSubIb:L}).unwrap();a!=null&&a.status&&(m(v({open:!0,message:a==null?void 0:a.message,severity:"success"})),y())}catch(a){(n=a==null?void 0:a.data)!=null&&n.status||m(v({open:!0,message:((o=a==null?void 0:a.data)==null?void 0:o.message)||"Failed to submit. Please try again later.",severity:"error"}))}},[g,{isLoading:x}]=F(),C=async()=>{var n,o;try{const a=await g({userId:t}).unwrap();a!=null&&a.status&&(m(v({open:!0,message:a==null?void 0:a.message,severity:"success"})),reset(defaultValues))}catch(a){(n=a==null?void 0:a.data)!=null&&n.status||m(v({open:!0,message:((o=a==null?void 0:a.data)==null?void 0:o.message)||"Failed to submit. Please try again later.",severity:"error"}))}};return s.jsx(S,{sx:{flexDirection:"row",gap:"10px"},children:d?s.jsx(G,{btnName:"Set commission",Content:W,contentData:{ibId:i,planId:d,userId:t},btnSx:{p:"8px",fontSize:".8rem"}}):s.jsxs(s.Fragment,{children:[s.jsx(M,{onClick:j,variant:"contained",disabled:p,sx:{minWidth:"1.5rem",fontSize:"13px",px:"8px",py:"4px"},children:(b=e==null?void 0:e.original)!=null&&b.isSubIb?"Remove Sub IB":"Make Sub IB"}),s.jsx(M,{sx:{textTransform:"none",color:"white",fontSize:"0.7rem",px:"8px",py:"4px"},onClick:C,disabled:x,variant:"contained",children:"Remove"})]})})}})].filter(Boolean),Q=u=>{const d=T.json_to_sheet(u),e=T.book_new();T.book_append_sheet(e,d,"Sheet1"),H(e,"userList.xlsx")},V=["Level - 1","Level - 2","Level - 3","Level - 4","Level - 5","Level - 6","Level - 7"];function $({ibId:u,planId:d,isSubIB:e}){var n,o;const{state:i}=N(),[t,y]=R.useState(""),[L,m]=R.useState({pageIndex:0,pageSize:10}),I=/Level\s*-\s*/,{data:p,isLoading:j,isError:g,error:x}=B({ibId:(i==null?void 0:i.ibId)||u}),C=(n=x==null?void 0:x.data)==null?void 0:n.message,l=((o=p==null?void 0:p.data)==null?void 0:o.userList)||[],h=R.useMemo(()=>{const a=t?l.filter(c=>(c==null?void 0:c.level)==t.replace(I,"")):l;return e?a.filter(c=>c==null?void 0:c.isSubIb):a},[l,t,e]),b=A({columns:Y({ibId:u,planId:d}),data:h,rowCount:h.length,onPaginationChange:m,state:{isLoading:j,pagination:L,showAlertBanner:g},enableColumnFilters:!1,enableSorting:!1,enableColumnActions:!1,initialState:{showGlobalFilter:!0},columnFilterDisplayMode:"popover",paginationDisplayMode:"pages",positionToolbarAlertBanner:"bottom",muiToolbarAlertBannerProps:g?{color:"error",children:C||"Error loading User List."}:void 0,renderTopToolbarCustomActions:()=>s.jsx(_,{sx:{display:"flex",gap:"16px",padding:"8px",flexWrap:"wrap"},children:s.jsx(M,{variant:"contained",onClick:()=>Q(l),startIcon:s.jsx(z,{sx:{color:"white"}}),sx:{textTransform:"none",color:"white",boxShadow:"none","&:hover":{boxShadow:"none"}},children:"Excel"})})});return s.jsx(S,{children:s.jsxs(S,{sx:{mt:"2rem"},children:[s.jsx(P,{items:V,width:"250px",value:t,onChange:a=>y(a.target.value)}),s.jsx(S,{sx:{marginTop:"2rem",borderRadius:"1.2rem",overflow:"hidden"},children:s.jsx(O,{table:b})})]})})}export{$ as I};
