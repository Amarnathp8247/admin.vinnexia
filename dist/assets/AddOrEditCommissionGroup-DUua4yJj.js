import{bz as b,c as _,a as re,b as te,r as j,cS as Ie,j as e,S as L,T as l,I as y,e as W,h as T,k as P,at as le,aW as w,aX as ve,bA as Ce,aw as ye,aG as oe,aB as Le,B as de,bG as Be,av as Ee,bb as ze,aD as Fe,cT as Me,bF as Pe,$ as Oe,ar as De,G as I,bn as ae,cL as ie,ax as A,cy as q}from"./index-B_S0l-pH.js";import{S as G}from"./SearchableSelector-C9pLKMko.js";import{O as Ne}from"./OverrideCommissionModal-VHz2Ddqg.js";import{M as me}from"./ModalComponent-CkQKoq1J.js";import{F as Te}from"./FileDownload-BsKDBh15.js";import{u as V,w as Ae}from"./xlsx-D1NZSDnX.js";import{C as qe}from"./Card-BbyUSaIa.js";import{R as ne}from"./RadioGroup-DXlFOIQ-.js";const Re=b.object({planId:b.number({required_error:"Plan is required"}).nullable().refine(n=>n!==null,{message:"Plan is required"}),cfdMetals:b.string(),cfdFx:b.string(),ibId:b.number({required_error:"IB is required"}).nullable().refine(n=>n!==null,{message:"IB is required"}),groupId:b.number({required_error:"Group Id is required"}).nullable().refine(n=>n!==null,{message:"Group Id is required"}),planType:b.string().min(1,"Select at least one plan type"),ibComission:b.string().min(1,"IB Commission is required"),symbolExtension:b.string().min(1,"IB Commission is required")}).transform(n=>Object.fromEntries(Object.entries(n).filter(([s,r])=>r!==void 0))),ke=b.object({overridePlanId:b.number({required_error:"Override plan is required"}).nullable().refine(n=>n!==null,{message:"Override plan is required"}),amount:b.string().min(1,"Commission is required")});function Ue({data:n,onClose:s}){const r=_(),t={overridePlanId:null,amount:""},{register:u,handleSubmit:d,reset:v,formState:{errors:B}}=re({resolver:te(ke),defaultValues:t});j.useEffect(()=>{v({overridePlanId:n})},[n]);const[C,{isLoading:x}]=Ie(),o=async g=>{var f,m;try{const a=await C(g).unwrap();a!=null&&a.status&&(r(P({open:!0,message:a==null?void 0:a.message,severity:"success"})),v({...t,amount:""}),s())}catch(a){(f=a==null?void 0:a.data)!=null&&f.status||r(P({open:!0,message:((m=a==null?void 0:a.data)==null?void 0:m.message)||"Failed to submit. Please try again later.",severity:"error"}))}};return e.jsxs(L,{component:"form",onSubmit:d(o),children:[e.jsx(l,{fontWeight:700,fontSize:"1.5rem",mb:"10px",children:"Update override commission"}),e.jsx(y,{sx:{mb:".5rem"},children:"Commission"}),e.jsx(W,{...u("amount",{required:!0}),size:"small",fullWidth:!0,variant:"outlined",placeholder:"Enter commission"}),B.amount&&e.jsx(l,{color:"error",fontSize:"14px",children:B.amount.message}),e.jsx(T,{variant:"contained",sx:{mt:"15px"},type:"submit",disabled:x,children:"Submit"})]})}const z=le();z.display({id:"ibName",header:"IB Name",Cell:({row:n})=>e.jsx(l,{children:n.original.ib.name})}),z.display({id:"ibEmail",header:"IB Email",Cell:({row:n})=>e.jsx(l,{children:n.original.ib.email})}),z.display({id:"userName",header:"Sub IB Name",Cell:({row:n})=>e.jsx(l,{children:n.original.user.name})}),z.display({id:"userEmail",header:"Sub IB Email",Cell:({row:n})=>e.jsx(l,{children:n.original.user.email})}),z.accessor("amount",{header:"Override commission",Cell:({row:n})=>e.jsx(l,{children:n.original.amount})}),z.accessor("status",{header:"Status",Cell:({row:n})=>{const s=n.original.isDeleted;return e.jsx(L,{sx:{flexDirection:"row",gap:"10px",color:s?"red":"green"},children:s?"Inactive":"Active"})}}),z.accessor("action",{header:"Action",size:150,Cell:({row:n})=>{const s=n.original.id;return e.jsx(L,{sx:{flexDirection:"row",gap:"10px"},children:e.jsx(me,{btnName:"Edit",Content:Ue,contentData:s})})}});const S=le(),Ge=({planId:n})=>[S.accessor("name",{header:"Name"}),S.accessor("userName",{header:"User Name"}),S.display({id:"referralUserName",header:"Referral user name",Cell:({row:s})=>{var r,t;return e.jsx(l,{children:(t=(r=s==null?void 0:s.original)==null?void 0:r.referralUser)==null?void 0:t.userName})}}),S.display({id:"referralUserEmail",header:"Referral user email",Cell:({row:s})=>{var r,t;return e.jsx(l,{children:(t=(r=s==null?void 0:s.original)==null?void 0:r.referralUser)==null?void 0:t.email})}}),S.accessor("level",{header:"Level"}),S.display({id:"comissionDetaild",header:"Comission",Cell:({row:s})=>{var r,t,u,d;return e.jsx(l,{children:(t=(r=s==null?void 0:s.original)==null?void 0:r.comissionDetaild)!=null&&t.comission?(d=(u=s==null?void 0:s.original)==null?void 0:u.comissionDetaild)==null?void 0:d.comission:0})}}),S.accessor("isSubIb",{header:"Sub IB",Cell:({row:s})=>{var r,t;return e.jsx(l,{sx:{color:(r=s==null?void 0:s.original)!=null&&r.isSubIb?"green":"red"},children:(t=s==null?void 0:s.original)!=null&&t.isSubIb?"Yes":"No"})}}),S.display({id:"commissionUpdateDate",header:"Commission update Date",Cell:({row:s})=>{var r,t,u,d;return(t=(r=s==null?void 0:s.original)==null?void 0:r.comissionDetaild)!=null&&t.updatedAt?e.jsx(l,{children:new Date((d=(u=s==null?void 0:s.original)==null?void 0:u.comissionDetaild)==null?void 0:d.updatedAt).toLocaleString()}):"N/A"}}),S.accessor("date",{header:"Registration Date",Cell:({row:s})=>e.jsx(l,{children:new Date(s.original.date).toLocaleString()})}),S.display({id:"action",header:"Action",Cell:({row:s})=>{var x,o,g;const{id:r}=w(),t=(x=s==null?void 0:s.original)==null?void 0:x.id,u=(o=s==null?void 0:s.original)!=null&&o.isSubIb?"false":"true",d=_(),[v,{isLoading:B}]=ve(),C=async()=>{var f,m;try{const a=await v({userId:t,isSubIb:u}).unwrap();a!=null&&a.status&&d(P({open:!0,message:a==null?void 0:a.message,severity:"success"}))}catch(a){(f=a==null?void 0:a.data)!=null&&f.status||d(P({open:!0,message:((m=a==null?void 0:a.data)==null?void 0:m.message)||"Failed to submit. Please try again later.",severity:"error"}))}};return e.jsx(L,{sx:{flexDirection:"row",gap:"10px"},children:n?e.jsx(me,{btnName:"Set/Update commission",Content:Ne,contentData:{ibId:r,planId:n,userId:t},btnSx:{p:"8px",fontSize:".8rem"}}):e.jsx(T,{onClick:C,variant:"contained",disabled:B,sx:{minWidth:"1.5rem",fontSize:"13px",px:"8px",py:"4px"},children:(g=s==null?void 0:s.original)!=null&&g.isSubIb?"Remove Sub IB":"Make Sub IB"})})}})].filter(Boolean),Ve=n=>{const s=V.json_to_sheet(n),r=V.book_new();V.book_append_sheet(r,s,"Sheet1"),Ae(r,"userList.xlsx")},We=["Level - 1","Level - 2","Level - 3","Level - 4","Level - 5","Level - 6","Level - 7"];function _e({ibId:n,isSubIB:s}){var D;const{id:r}=w(),[t,u]=j.useState(""),[d,v]=j.useState({pageIndex:0,pageSize:10}),B=/Level\s*-\s*/,{data:C,isLoading:x,isError:o,error:g}=Ce({planId:r},{skip:!r}),f=(D=g==null?void 0:g.data)==null?void 0:D.message,m=(C==null?void 0:C.data)||[],a=j.useMemo(()=>{const F=t?m.filter(h=>(h==null?void 0:h.level)==t.replace(B,"")):m;return s?F.filter(h=>h==null?void 0:h.isSubIb):F},[m,t,s]),O=ye({columns:Ge({planId:r}),data:a,rowCount:a.length,onPaginationChange:v,state:{isLoading:x,pagination:d,showAlertBanner:o},enableColumnFilters:!1,enableSorting:!1,enableColumnActions:!1,initialState:{showGlobalFilter:!0},columnFilterDisplayMode:"popover",paginationDisplayMode:"pages",positionToolbarAlertBanner:"bottom",muiToolbarAlertBannerProps:o?{color:"error",children:f||"Error loading User List."}:void 0,renderTopToolbarCustomActions:()=>e.jsx(de,{sx:{display:"flex",gap:"16px",padding:"8px",flexWrap:"wrap"},children:e.jsx(T,{variant:"contained",onClick:()=>Ve(m),startIcon:e.jsx(Te,{sx:{color:"white"}}),sx:{textTransform:"none",color:"white",boxShadow:"none","&:hover":{boxShadow:"none"}},children:"Excel"})})});return e.jsx(L,{children:e.jsxs(L,{sx:{mt:"2rem"},children:[e.jsx(oe,{items:We,width:"250px",value:t,onChange:F=>u(F.target.value)}),e.jsx(L,{sx:{marginTop:"2rem",borderRadius:"1.2rem",overflow:"hidden"},children:e.jsx(Le,{table:O})})]})})}const we=[{label:"IB COMISSION MODEL",value:"IB-COMISSION-MODEL"},{label:"REBET MODEL",value:"REBET-MODEL"},{label:"GLOBAL MODEL",value:"GLOBAL-MODEL"}];function es(){var Q,H,X,Y,J,K,Z,ee;const n=_(),[s,r]=j.useState(""),[t,u]=j.useState(""),[d,v]=j.useState(""),[B,C]=j.useState("Basic"),{id:x}=w(),o=!!x,[g,f]=j.useState(!o),{data:m}=Be({planId:x},{skip:!x}),a=((Q=m==null?void 0:m.data)==null?void 0:Q.ibPlanList[0])||null,O={ibId:null,planId:null,groupId:null,planType:"",cfdMetals:"false",cfdFx:"false",ibComission:"",symbolExtension:""},{register:D,handleSubmit:F,reset:h,watch:E,setValue:M,formState:{errors:c}}=re({resolver:te(Re),defaultValues:O});j.useEffect(()=>{var i,N;o&&a?(h({ibId:a.ibId||null,groupId:a.groupId||null,planId:a.planId||"",planType:a.planType||"",cfdMetals:((i=a.cfdMetals)==null?void 0:i.length)>0?"true":"false",cfdFx:((N=a.cfdFx)==null?void 0:N.length)>0?"true":"false",symbolExtension:a.symbolExtension||"",ibComission:String(a.ibComission)||""}),f(!0)):x||(h(O),f(!0))},[x,a,h]);const{data:R,isLoading:ce}=Ee({page:1,sizePerPage:20,isIb:!0,search:s},{skip:s.length<3}),{data:k,isLoading:ue}=ze({page:1,sizePerPage:20,search:t},{skip:t.length<2}),{data:U,isLoading:xe}=Fe({page:1,sizePerPage:20,search:d},{skip:d.length<2}),$=d.length>=2?((H=U==null?void 0:U.data)==null?void 0:H.groupsList)||[]:[],pe=s.length>=3?((X=R==null?void 0:R.data)==null?void 0:X.usersList)||[]:[],he=t.length>=2?((Y=k==null?void 0:k.data)==null?void 0:Y.ibComissionNameList)||[]:[],[be,{isLoading:ge}]=Me(),[fe,{isLoading:Se}]=Pe(),je=async i=>{var N,se;try{o&&delete i.ibId,o&&i.planName==a.planName&&delete i.planName;const p=await(o?fe({...i,planId:x}).unwrap():be(i).unwrap());p!=null&&p.status&&(n(P({open:!0,message:p==null?void 0:p.message,severity:"success"})),o||h(O))}catch(p){(N=p==null?void 0:p.data)!=null&&N.status||n(P({open:!0,message:((se=p==null?void 0:p.data)==null?void 0:se.message)||"Failed to submit. Please try again later.",severity:"error"}))}};return e.jsxs(e.Fragment,{children:[e.jsxs(L,{children:[e.jsx(l,{sx:{fontSize:"2rem",fontWeight:"700"},children:o?"Edit Commission":"Add Commission"}),e.jsx(de,{sx:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:e.jsx(T,{component:Oe,to:"/admin/IBManagement/commissionGroup",variant:"contained",sx:{textTransform:"capitalize",boxShadow:"none",color:"white","&:hover":{boxShadow:"none"}},children:"View Commission"})}),g?e.jsxs(qe,{sx:{boxShadow:"0 0px 0px 0 rgba(0, 0, 0, 0.19), 0 0px 8px 0 rgba(0, 0, 0, 0.19)",borderRadius:"1.2rem",padding:{xs:"1rem",md:"2rem"},mt:"2rem"},component:"form",onSubmit:F(je),children:[e.jsxs(I,{container:!0,size:12,spacing:3,children:[e.jsxs(I,{item:!0,size:{xs:12,sm:6,md:4},children:[e.jsx(y,{sx:{mb:".5rem"},children:"Select IB *"}),e.jsx(G,{width:"100%",items:o?[{value:a.ibId,name:`${(J=a==null?void 0:a.ib)==null?void 0:J.name} (${(K=a==null?void 0:a.ib)==null?void 0:K.email})`}]:pe.map(i=>({value:i.id,name:`${i.name} (${i.email})`})),disabled:!!o,value:E("ibId"),onChange:i=>M("ibId",i,{shouldValidate:!0}),onSearchChange:i=>r(i),isLoading:ce,shouldBeFullwidth:!0}),c.ibId&&e.jsx(l,{color:"error",fontSize:"14px",children:c.ibId.message})]}),e.jsxs(I,{item:!0,size:{xs:12,sm:6,md:4},children:[e.jsx(y,{sx:{mb:".5rem"},children:"Select Plan *"}),e.jsx(G,{width:"100%",items:o?[{value:a.planId,name:(Z=a==null?void 0:a.plan)==null?void 0:Z.planName}]:he.map(i=>({value:i.id,name:`${i.planName}`})),disabled:!!o,value:E("planId"),onChange:i=>M("planId",i,{shouldValidate:!0}),onSearchChange:i=>u(i),isLoading:ue,shouldBeFullwidth:!0}),c.planId&&e.jsx(l,{color:"error",fontSize:"14px",children:c.planId.message})]}),e.jsxs(I,{size:{xs:12,sm:6,md:4},children:[e.jsx(y,{sx:{mb:".5rem"},children:"Select MT5 group *"}),e.jsx(G,{width:"100%",items:o?[{value:a.groupId,name:(ee=a==null?void 0:a.group)==null?void 0:ee.name},...$.map(i=>({value:i.id,name:i.name}))]:$.map(i=>({value:i.id,name:i.name})),value:E("groupId"),onChange:i=>M("groupId",i,{shouldValidate:!0}),onSearchChange:i=>v(i),isLoading:xe,shouldBeFullwidth:!0}),e.jsx(y,{sx:{fontSize:"12px"},children:"Please enter 2 or more characters"}),c.groupId&&e.jsx(l,{color:"error",fontSize:"14px",children:c.groupId.message})]}),e.jsxs(I,{size:{xs:12,sm:6,md:4},children:[e.jsx(y,{sx:{mb:".5rem"},children:"Select Plan Type*"}),e.jsx(oe,{items:we,value:E("planType"),onChange:i=>M("planType",i.target.value,{shouldValidate:!0}),shouldBeFullWidth:!0})]}),e.jsxs(I,{size:{xs:12,sm:6,md:4},children:[e.jsxs(ae,{children:[e.jsx(ie,{id:"demo-row-radio-buttons-group-label",children:"CFD Metals *"}),e.jsxs(ne,{row:!0,"aria-labelledby":"demo-row-radio-buttons-group-label",name:"row-radio-buttons-group",value:E("cfdMetals"),onChange:i=>M("cfdMetals",i.target.value,{shouldValidate:!0}),children:[e.jsx(A,{value:"true",control:e.jsx(q,{}),label:"Allow"}),e.jsx(A,{value:"false",control:e.jsx(q,{}),label:"Not-allow"})]})]}),c.cfdMetals&&e.jsx(l,{color:"error",fontSize:"14px",children:c.cfdMetals.message})]}),e.jsxs(I,{size:{xs:12,sm:6,md:4},children:[e.jsxs(ae,{children:[e.jsx(ie,{id:"demo-row-radio-buttons-group-label",children:"CFD Fx *"}),e.jsxs(ne,{row:!0,"aria-labelledby":"demo-row-radio-buttons-group-label",name:"row-radio-buttons-group",value:E("cfdFx"),onChange:i=>M("cfdFx",i.target.value,{shouldValidate:!0}),children:[e.jsx(A,{value:"true",control:e.jsx(q,{}),label:"Allow"}),e.jsx(A,{value:"false",control:e.jsx(q,{}),label:"Not-allow"})]})]}),c.cfdFx&&e.jsx(l,{color:"error",fontSize:"14px",children:c.cfdFx.message})]}),e.jsxs(I,{item:!0,size:{xs:12,sm:6,md:4},children:[e.jsx(y,{sx:{mb:".5rem"},children:"IB Commission *"}),e.jsx(W,{...D("ibComission",{required:!0}),size:"small",fullWidth:!0,variant:"outlined",placeholder:"Enter Level1 commission"}),c.ibComission&&e.jsx(l,{color:"error",fontSize:"14px",children:c.ibComission.message})]}),e.jsxs(I,{item:!0,size:{xs:12,sm:6,md:4},children:[e.jsx(y,{sx:{mb:".5rem"},children:"Symbol Extension *"}),e.jsx(W,{...D("symbolExtension",{required:!0}),size:"small",fullWidth:!0,variant:"outlined",placeholder:"Enter symbol extension"}),c.symbolExtension&&e.jsx(l,{color:"error",fontSize:"14px",children:c.symbolExtension.message})]})]}),e.jsx(T,{variant:"contained",type:"submit",disabled:ge||Se,sx:{textTransform:"capitalize",boxShadow:"none",color:"white",mt:"1.5rem",alignSelf:"self-start","&:hover":{boxShadow:"none"}},children:"Submit"})]}):e.jsx(De,{})]}),o&&E("ibId")&&e.jsxs(e.Fragment,{children:[e.jsx(l,{fontWeight:700,fontSize:"1.5rem",mt:"2rem",children:"SUB IB Users"}),e.jsx(_e,{isSubIB:!0})]})]})}export{es as default};
