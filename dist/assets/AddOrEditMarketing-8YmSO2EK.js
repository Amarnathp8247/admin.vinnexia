import{o as V,aN as P,s as c,aE as O,aO as K,c as H,aX as U,r as S,cQ as X,b7 as Z,a as J,b as Y,cR as _,bQ as D,j as e,S as ee,B as se,Q as ae,g as re,Z as te,a$ as ie,T as l,at as ne,aH as le,G as o,I as m,e as g,aI as oe,h as me,i as N}from"./index-oaA_Ltxz.js";import{S as de}from"./SearchableSelector-B0BDCd1f.js";import{C as ce}from"./Card-CaAkebAw.js";const ue=x=>V({name:c().trim().min(1,"User name is required").min(3,"Name must be at least 3 characters"),email:c().trim().email("Please enter a valid email"),mobile:c().min(10,"Mobile number must be at least 10 digits"),password:P(r=>typeof r=="string"?r.trim():r,x?c().min(8,"Password must be at least 8 characters").or(K("")):c().min(8,"Password must be at least 8 characters")),role:c().min(1,"Please select the role"),managerId:P(r=>r===""||r===void 0?void 0:Number(r),O().optional())});function pe(){var I,k,v;const x=H(),{id:r}=U(),i=!!r,[R,w]=S.useState(!i),{data:p,refetch:B}=X({id:r},{skip:!r}),a=(p==null?void 0:p.data)||null,[b,E]=S.useState(""),{data:f,isLoading:F}=Z({page:1,sizePerPage:5,search:b,role:"MANAGER"},{skip:b.length<3}),y=b.length>=3?((I=f==null?void 0:f.data)==null?void 0:I.usersList)||[]:[],j={name:"",email:"",mobile:"",password:"",role:"",managerId:""},{register:h,handleSubmit:G,getValues:$,reset:u,watch:M,setValue:z,formState:{errors:t}}=J({resolver:Y(ue(i)),defaultValues:j});S.useEffect(()=>{i&&a?(u({name:a.name||"",email:a.email||"",mobile:a.mobile||"",role:a.role||"",managerId:a.fromManager||null,password:""}),w(!0)):r||(u(j),w(!0))},[r,a,u]);const[W,{isLoading:q}]=_(),[C,{isLoading:Q}]=D(),T=async s=>{var L,A;try{const n={...s};i&&delete n.managerId,i&&!s.password&&delete n.password;const d=await(i?C({...n,marketingId:r}).unwrap():W(s).unwrap());d!=null&&d.status&&(x(N({open:!0,message:d==null?void 0:d.message,severity:"success"})),i?(await B(),u($())):u(j))}catch(n){(L=n==null?void 0:n.data)!=null&&L.status||x(N({open:!0,message:((A=n==null?void 0:n.data)==null?void 0:A.message)||"Failed to submit. Please try again later.",severity:"error"}))}};return e.jsxs(ee,{children:[e.jsxs(se,{sx:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(ae,{title:"Back",placement:"bottom-end",children:e.jsx(re,{component:te,to:"/admin/marketing/marketingList",children:e.jsx(ie,{})})}),e.jsx(l,{sx:{fontSize:"2rem",fontWeight:"700"},children:i?"Edit Marketing":"Add Marketing"})]}),R?e.jsxs(ce,{sx:{boxShadow:"0 0px 0px 0 rgba(0, 0, 0, 0.19), 0 0px 8px 0 rgba(0, 0, 0, 0.19)",borderRadius:"1.2rem",padding:{xs:"1rem",md:"2rem"},mt:"2rem"},component:"form",onSubmit:G(T),children:[e.jsx(l,{mx:{xs:"1rem",md:"0"},children:"Fill Details"}),e.jsx(le,{sx:{my:"1.2rem"}}),e.jsxs(o,{container:!0,size:12,spacing:2,children:[e.jsxs(o,{item:!0,size:{xs:12,sm:6,md:4},children:[e.jsx(m,{sx:{mb:".5rem"},children:"Name *"}),e.jsx(g,{...h("name",{required:!0}),size:"small",fullWidth:!0,variant:"outlined",placeholder:"Name"}),t.name&&e.jsx(l,{color:"error",fontSize:"14px",children:t.name.message})]}),e.jsxs(o,{item:!0,size:{xs:12,sm:6,md:4},children:[e.jsx(m,{sx:{mb:".5rem"},children:"Email *"}),e.jsx(g,{...h("email",{required:!0}),size:"small",fullWidth:!0,variant:"outlined",placeholder:"Email"}),t.email&&e.jsx(l,{color:"error",fontSize:"14px",children:t.email.message})]}),e.jsxs(o,{item:!0,size:{xs:12,sm:6,md:4},children:[e.jsx(m,{sx:{mb:".5rem"},children:"Mobile *"}),e.jsx(g,{...h("mobile",{required:!0}),onInput:s=>{s.target.value.length>10&&(s.target.value=s.target.value.slice(0,10))},type:"number",size:"small",fullWidth:!0,placeholder:"Enter Phone",variant:"outlined"}),t.mobile&&e.jsx(l,{color:"error",fontSize:"14px",children:t.mobile.message})]}),e.jsxs(o,{item:!0,size:{xs:12,sm:6,md:4},children:[e.jsx(m,{sx:{mb:".5rem"},children:"Password *"}),e.jsx(g,{...h("password",{required:!0}),size:"small",fullWidth:!0,variant:"outlined",placeholder:"Password"}),t.password&&e.jsx(l,{color:"error",fontSize:"14px",children:t.password.message})]}),e.jsxs(o,{item:!0,size:{xs:12,sm:6,md:4},children:[e.jsx(m,{sx:{mb:".5rem"},children:"Select Role"}),e.jsx(oe,{value:M("role"),items:["MANAGER","MARKETING"],selected:"MANAGER",onChange:s=>z("role",s.target.value,{shouldValidate:!0}),shouldBeFullWidth:!0}),t.role&&e.jsx(l,{color:"error",fontSize:"14px",children:t.role.message})]}),M("role")=="MARKETING"&&!i&&e.jsxs(o,{item:!0,size:{xs:12,sm:6,md:4},children:[e.jsx(m,{sx:{mb:".5rem"},children:"Select Manager *"}),e.jsx(de,{width:"100%",items:i?[{value:a==null?void 0:a.fromManager,name:`${(k=a==null?void 0:a.manager)==null?void 0:k.name} (${(v=a==null?void 0:a.manager)==null?void 0:v.email})`},...y.filter(s=>s.id!==(a==null?void 0:a.fromManager)).map(s=>({value:s.id,name:`${s.name} (${s.email})`}))]:y.map(s=>({value:s.id,name:`${s.name} (${s.email})`})),value:M("managerId"),onChange:s=>z("managerId",s,{shouldValidate:!0}),onSearchChange:s=>E(s),isLoading:F,shouldBeFullwidth:!0}),e.jsx(m,{sx:{fontSize:"12px"},children:"Please enter 3 or more characters"}),t.managerId&&e.jsx(l,{color:"error",fontSize:"14px",children:t.managerId.message})]})]}),e.jsx(me,{variant:"contained",type:"submit",disabled:q||Q,sx:{textTransform:"capitalize",boxShadow:"none",color:"white",mt:"1.5rem",alignSelf:"self-start","&:hover":{boxShadow:"none"}},children:"Submit"})]}):e.jsx(ne,{})]})}export{pe as default};
