import{bR as D,bS as F,U as W,c as z,a2 as G,bT as V,a as H,r as x,bU as K,j as e,at as Q,B as f,Q as Z,g as $,Z as q,a$ as J,T as b,S as N,h as g,aH as X,G as I,bV as Y,az as _,aA as ee,b as se,i as R}from"./index-oaA_Ltxz.js";const te=D(F()),re=o=>o.split("-").map(c=>c.charAt(0).toUpperCase()+c.slice(1).toLowerCase()).join(" "),ae=o=>o&&o!=="Misc"?o.charAt(0).toUpperCase()+o.slice(1).toLowerCase():"Misc";function ne({id:o}){const{state:c}=W(),p=o||(c==null?void 0:c.marketingId),L=c==null?void 0:c.marketingMemberName,j=z(),{selectedTheme:k}=G(t=>t.themeMode),{data:h,isLoading:O,refetch:M}=V({id:p},{skip:!p}),d=(h==null?void 0:h.data)||null,{control:U,handleSubmit:w,reset:m,getValues:y,setValue:P,formState:{isSubmitting:S}}=H({resolver:se(te),defaultValues:{}}),T=x.useMemo(()=>{const t={};return d&&Object.entries(d).forEach(([s,a])=>{t[s]=!!a}),t},[d]),C=x.useMemo(()=>{const t={},s=(r,n)=>{t[r]||(t[r]=[]),t[r].push(n)};Object.keys(T).forEach(r=>{const n=r.toUpperCase();if(n.includes("PASSWORD")){s("USER",r);return}if(n.includes("TRANSACTION")||n.includes("DEPOSIT")||n.includes("WITHDRAW")||n.includes("WALLET")||n.includes("FUND")||n.includes("TRANSFER")){s("TRANSACTION",r);return}if(n.includes("REFERRAL")||n.startsWith("IB-")){s("IB",r);return}const l=r.indexOf("-"),u=l===-1?"Misc":r.slice(0,l).toUpperCase();s(u,r)});let a=Object.entries(t).map(([r,n])=>({groupKey:r,displayName:ae(r),permissions:n.map(l=>({name:l,fieldName:re(l)}))}));const i=["MARKETING","USER","IB","META","SUPPORT","TRANSACTION","MISC","Misc"];return a.sort((r,n)=>{const l=i.indexOf(r.groupKey),u=i.indexOf(n.groupKey);return l===-1&&u===-1?r.groupKey.localeCompare(n.groupKey):l===-1?1:u===-1?-1:l-u}),a},[T]);x.useEffect(()=>{if(d){const t=Object.entries(d).reduce((s,[a,i])=>(s[a]=!!i,s),{});m(t)}else m({})},[d,m]);const[v,{isLoading:E}]=K(),B=async t=>{var s;try{const a={...t,userId:p},i=await v(a).unwrap();i!=null&&i.status&&(j(R({open:!0,message:i==null?void 0:i.message,severity:"success"})),await M(),m(y()))}catch(a){j(R({open:!0,message:((s=a==null?void 0:a.data)==null?void 0:s.message)||"Failed to submit. Please try again later.",severity:"error"}))}},A=(t,s)=>{const i={...y()};t.forEach(r=>{i[r]=!!s,P(r,!!s,{shouldValidate:!1,shouldDirty:!0})}),m(i,{keepDirty:!0,keepTouched:!0,keepErrors:!0})};return e.jsx(e.Fragment,{children:O?e.jsx(Q,{}):e.jsxs(e.Fragment,{children:[e.jsxs(f,{sx:{mb:"2rem",display:"flex",alignItems:"center",gap:"15px"},children:[!o&&e.jsx(Z,{title:"Back",placement:"bottom-end",children:e.jsx($,{component:q,to:"/admin/marketing/marketingList",children:e.jsx(J,{})})}),e.jsxs(b,{sx:{fontWeight:700,py:"20px",fontSize:o?"1.2rem":"2rem",color:"text.primary"},children:["Edit Permissions :- ",L]})]}),e.jsxs(f,{sx:{p:3,borderRadius:"1rem",bgcolor:k==="dark"?"#272727":"#e9e6e6"},component:"form",onSubmit:w(B),children:[C.length===0&&e.jsx(b,{sx:{mb:2},children:"No permissions found for this user."}),C.map(t=>e.jsxs(f,{sx:{mb:4},children:[e.jsxs(N,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:1},children:[e.jsx(b,{variant:"h6",children:t.displayName}),e.jsxs(N,{direction:"row",spacing:1,children:[e.jsx(g,{size:"small",variant:"outlined",onClick:()=>A(t.permissions.map(s=>s.name),!0),children:"Select all"}),e.jsx(g,{size:"small",variant:"outlined",onClick:()=>A(t.permissions.map(s=>s.name),!1),children:"Clear all"})]})]}),e.jsx(X,{sx:{mb:2,borderWidth:"2px"}}),e.jsx(I,{container:!0,spacing:2,children:t.permissions.map(s=>e.jsx(I,{item:!0,xs:12,sm:6,md:3,children:e.jsx(Y,{name:s.name,control:U,render:({field:a})=>e.jsx(_,{control:e.jsx(ee,{...a,checked:!!a.value,onChange:i=>a.onChange(i.target.checked),sx:{"&.Mui-checked":{color:"primary.main"}}}),label:s.fieldName})})},s.name))})]},t.groupKey)),e.jsx(g,{variant:"contained",type:"submit",disabled:E||S,sx:{textTransform:"capitalize",boxShadow:"none",color:"white",alignSelf:"self-start","&:hover":{boxShadow:"none"}},children:E||S?"Updating...":"Update"})]})]})})}export{ne as default};
