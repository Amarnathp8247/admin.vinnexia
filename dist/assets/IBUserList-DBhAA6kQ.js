import{o as P,aE as U,c as A,r as M,b7 as N,a as R,b as D,b8 as _,j as t,S as B,T as l,B as E,I as w,h as L,i as j,av as W,U as C,Z as T,ax as $,ay as q,aD as G}from"./index-oaA_Ltxz.js";import{F as H}from"./FileDownload-Cn3EXkSJ.js";import{u as S,w as V}from"./xlsx-D1NZSDnX.js";import{M as Q}from"./ModalComponent-DTq5tozF.js";import{S as Z}from"./SearchableSelector-B0BDCd1f.js";const J=P({marketingMemberId:U({required_error:"Marketing member is required"}).nullable().refine(e=>e!==null,{message:"Marketing member is required"})});function K({data:e}){var y;const a=e,s=A(),[n,o]=M.useState(""),i={marketingMemberId:null},{data:d,isLoading:u}=N({page:1,sizePerPage:10,search:n},{skip:n.length<3}),b=n.length>=3?((y=d==null?void 0:d.data)==null?void 0:y.usersList)||[]:[],{handleSubmit:f,reset:g,watch:h,setValue:x,formState:{errors:p}}=R({resolver:D(J),defaultValues:i}),[v,{isLoading:z}]=_(),F=async m=>{var I,k;try{const r=await v({...m,ibId:a}).unwrap();r!=null&&r.status&&(s(j({open:!0,message:r==null?void 0:r.message,severity:"success"})),g(i))}catch(r){(I=r==null?void 0:r.data)!=null&&I.status||s(j({open:!0,message:((k=r==null?void 0:r.data)==null?void 0:k.message)||"Failed to submit. Please try again later.",severity:"error"}))}};return t.jsxs(B,{component:"form",onSubmit:f(F),children:[t.jsx(l,{fontWeight:700,fontSize:"1.5rem",mb:"1.5rem",children:"Assign To"}),t.jsxs(E,{children:[t.jsx(w,{sx:{mb:".5rem"},children:"Select Marketing *"}),t.jsx(Z,{width:"100%",items:b.map(m=>({value:m.id,name:`${m.name} (${m.email})`})),value:h("marketingMemberId"),onChange:m=>x("marketingMemberId",m,{shouldValidate:!0}),onSearchChange:m=>o(m),isLoading:u,shouldBeFullwidth:!0}),p.marketingMemberId&&t.jsx(l,{color:"error",fontSize:"14px",children:p.marketingMemberId.message})]}),t.jsx(L,{type:"submit",variant:"contained",disabled:z,sx:{textTransform:"capitalize",boxShadow:"none",color:"white",mt:"1.5rem",alignSelf:"self-start","&:hover":{boxShadow:"none"}},children:"Assign"})]})}const c=W(),O=[c.accessor("name",{header:"Name",Cell:({row:e})=>{var n;const{pathname:a}=C(),s=(n=e==null?void 0:e.original)==null?void 0:n.id;return t.jsx(l,{component:T,to:`/admin/IBManagement/IBUserDetails/${s}`,state:{pathname:a},sx:{color:"inherit"},children:e.original.name})}}),c.accessor("email",{header:"Email",Cell:({row:e})=>{var n;const{pathname:a}=C(),s=(n=e==null?void 0:e.original)==null?void 0:n.id;return t.jsx(l,{component:T,to:`/admin/IBManagement/IBUserDetails/${s}`,state:{pathname:a},sx:{color:"inherit"},children:e.original.email})}}),c.accessor("mobile",{header:"Phone"}),c.accessor("country",{header:"Country"}),c.display({id:"parentName",header:"Parent Name",Cell:({row:e})=>{var s,n;const a=(n=(s=e==null?void 0:e.original)==null?void 0:s.parent)==null?void 0:n.name;return t.jsx(l,{component:a?"p":"em",sx:{fontSize:!a&&"12px"},children:a||"Empty"})}}),c.display({id:"parentEmail",header:"Parent Email",Cell:({row:e})=>{var s,n;const a=(n=(s=e==null?void 0:e.original)==null?void 0:s.parent)==null?void 0:n.email;return t.jsx(l,{component:a?"p":"em",sx:{fontSize:!a&&"12px"},children:a||"Empty"})}}),c.display({id:"parantUserName",header:"Parant User Name",Cell:({row:e})=>{var s,n;const a=(n=(s=e==null?void 0:e.original)==null?void 0:s.parent)==null?void 0:n.userName;return t.jsx(l,{component:a?"p":"em",sx:{fontSize:!a&&"12px"},children:a||"Empty"})}}),c.accessor("remark",{header:"Remark",Cell:({row:e})=>e.original.remark?t.jsx(l,{sx:{fontSize:"14px"},children:e.original.remark}):t.jsx(l,{sx:{fontSize:"13px"},children:"Not - available"})}),c.display({id:"action",header:"Action",Cell:({row:e})=>{const a=e.original.id;return t.jsx(Q,{Content:K,btnName:"Assign To",contentData:a,modalWidth:{xs:"95%",sm:600},btnSx:{textTransform:"none",color:"white",fontSize:"0.7rem",px:"8px",py:"4px"}})}})],X=e=>{const a=e.getRowModel().rows.map(o=>{const i=o.original;return{"User Name":i.name,Email:i.email,CountryCode:i.countryCode,Phone:i.mobile,Country:i.country}}),s=S.json_to_sheet(a),n=S.book_new();S.book_append_sheet(n,s,"MT5 Users"),V(n,"IBuserList.xlsx")};function se(){var h,x,p;const[e,a]=M.useState({pageIndex:0,pageSize:10}),[s,n]=M.useState(""),{data:o,isLoading:i,isError:d,error:u}=$({page:e.pageIndex+1,sizePerPage:e.pageSize,isIb:!0,search:s}),b=(h=u==null?void 0:u.data)==null?void 0:h.message,f=((x=o==null?void 0:o.data)==null?void 0:x.usersList)||[],g=q({columns:O,data:f,enableColumnFilters:!1,enableSorting:!1,enableColumnActions:!1,manualPagination:!0,manualFiltering:!0,rowCount:((p=o==null?void 0:o.data)==null?void 0:p.totalRecords)||0,state:{pagination:e,isLoading:i,showAlertBanner:d},initialState:{showGlobalFilter:!0},onPaginationChange:a,onGlobalFilterChange:n,columnFilterDisplayMode:"popover",paginationDisplayMode:"pages",positionToolbarAlertBanner:"bottom",muiToolbarAlertBannerProps:d?{color:"error",children:b||"Error loading IB User List."}:void 0,renderTopToolbarCustomActions:()=>t.jsx(E,{sx:{display:"flex",gap:"16px",padding:"8px",flexWrap:"wrap"},children:t.jsx(L,{variant:"contained",onClick:()=>X(g),startIcon:t.jsx(H,{sx:{color:"white"}}),sx:{textTransform:"none",color:"white",boxShadow:"none","&:hover":{boxShadow:"none"}},children:"Excel"})})});return t.jsxs(t.Fragment,{children:[t.jsx(l,{variant:"h5",fontWeight:"700",fontSize:"1.8rem",mb:"2rem",children:"IB User List"}),t.jsx(B,{sx:{marginTop:"2rem",borderRadius:"1.2rem",overflow:"hidden"},children:t.jsx(G,{table:g})})]})}export{se as default};
