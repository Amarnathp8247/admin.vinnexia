import{o as Q,aM as P,s as c,aC as K,aN as O,c as U,aW as _,r as S,cQ as H,b7 as J,a as X,b as Y,cR as Z,bQ as D,j as e,S as ee,B as se,R as re,g as ae,$ as te,a_ as ie,T as l,ar as ne,aF as le,G as o,I as m,e as g,aG as oe,h as me,k as R}from"./index-DcG3qw6T.js";import{S as de}from"./SearchableSelector-BYsl9Yx6.js";import{C as ce}from"./Card-BPwIXuQj.js";const ue=x=>Q({name:c().trim().min(1,"User name is required").min(3,"Name must be at least 3 characters"),email:c().trim().email("Please enter a valid email"),mobile:c().min(10,"Mobile number must be at least 10 digits"),password:P(a=>typeof a=="string"?a.trim():a,x?c().min(8,"Password must be at least 8 characters").or(O("")):c().min(8,"Password must be at least 8 characters")),role:c().min(1,"Please select the role"),managerId:P(a=>a===""||a===void 0?void 0:Number(a),K().optional())});function pe(){var I,k,v;const x=U(),{id:a}=_(),i=!!a,[N,w]=S.useState(!i),{data:p,refetch:B}=H({id:a},{skip:!a}),r=(p==null?void 0:p.data)||null,[b,E]=S.useState(""),{data:f,isLoading:F}=J({page:1,sizePerPage:5,search:b,role:"MANAGER"},{skip:b.length<3}),y=b.length>=3?((I=f==null?void 0:f.data)==null?void 0:I.usersList)||[]:[],j={name:"",email:"",mobile:"",password:"",role:"",managerId:""},{register:h,handleSubmit:G,getValues:W,reset:u,watch:M,setValue:z,formState:{errors:t}}=X({resolver:Y(ue(i)),defaultValues:j});S.useEffect(()=>{i&&r?(u({name:r.name||"",email:r.email||"",mobile:r.mobile||"",role:r.role||"",managerId:r.fromManager||null,password:""}),w(!0)):a||(u(j),w(!0))},[a,r,u]);const[$,{isLoading:C}]=Z(),[q,{isLoading:T}]=D(),V=async s=>{var L,A;try{const n={...s};i&&delete n.managerId,i&&!s.password&&delete n.password;const d=await(i?q({...n,marketingId:a}).unwrap():$(s).unwrap());d!=null&&d.status&&(x(R({open:!0,message:d==null?void 0:d.message,severity:"success"})),i?(await B(),u(W())):u(j))}catch(n){(L=n==null?void 0:n.data)!=null&&L.status||x(R({open:!0,message:((A=n==null?void 0:n.data)==null?void 0:A.message)||"Failed to submit. Please try again later.",severity:"error"}))}};return e.jsxs(ee,{children:[e.jsxs(se,{sx:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(re,{title:"Back",placement:"bottom-end",children:e.jsx(ae,{component:te,to:"/admin/marketing/marketingList",children:e.jsx(ie,{})})}),e.jsx(l,{sx:{fontSize:"2rem",fontWeight:"700"},children:i?"Edit Marketing":"Add Marketing"})]}),N?e.jsxs(ce,{sx:{boxShadow:"0 0px 0px 0 rgba(0, 0, 0, 0.19), 0 0px 8px 0 rgba(0, 0, 0, 0.19)",borderRadius:"1.2rem",padding:{xs:"1rem",md:"2rem"},mt:"2rem"},component:"form",onSubmit:G(V),children:[e.jsx(l,{mx:{xs:"1rem",md:"0"},children:"Fill Details"}),e.jsx(le,{sx:{my:"1.2rem"}}),e.jsxs(o,{container:!0,size:12,spacing:2,children:[e.jsxs(o,{item:!0,size:{xs:12,sm:6,md:4},children:[e.jsx(m,{sx:{mb:".5rem"},children:"Name *"}),e.jsx(g,{...h("name",{required:!0}),size:"small",fullWidth:!0,variant:"outlined",placeholder:"Name"}),t.name&&e.jsx(l,{color:"error",fontSize:"14px",children:t.name.message})]}),e.jsxs(o,{item:!0,size:{xs:12,sm:6,md:4},children:[e.jsx(m,{sx:{mb:".5rem"},children:"Email *"}),e.jsx(g,{...h("email",{required:!0}),size:"small",fullWidth:!0,variant:"outlined",placeholder:"Email"}),t.email&&e.jsx(l,{color:"error",fontSize:"14px",children:t.email.message})]}),e.jsxs(o,{item:!0,size:{xs:12,sm:6,md:4},children:[e.jsx(m,{sx:{mb:".5rem"},children:"Mobile *"}),e.jsx(g,{...h("mobile",{required:!0}),onInput:s=>{s.target.value.length>10&&(s.target.value=s.target.value.slice(0,10))},type:"number",size:"small",fullWidth:!0,placeholder:"Enter Phone",variant:"outlined"}),t.mobile&&e.jsx(l,{color:"error",fontSize:"14px",children:t.mobile.message})]}),e.jsxs(o,{item:!0,size:{xs:12,sm:6,md:4},children:[e.jsx(m,{sx:{mb:".5rem"},children:"Password *"}),e.jsx(g,{...h("password",{required:!0}),size:"small",fullWidth:!0,variant:"outlined",placeholder:"Password"}),t.password&&e.jsx(l,{color:"error",fontSize:"14px",children:t.password.message})]}),e.jsxs(o,{item:!0,size:{xs:12,sm:6,md:4},children:[e.jsx(m,{sx:{mb:".5rem"},children:"Select Role"}),e.jsx(oe,{value:M("role"),items:["MANAGER","MARKETING"],selected:"MANAGER",onChange:s=>z("role",s.target.value,{shouldValidate:!0}),shouldBeFullWidth:!0}),t.role&&e.jsx(l,{color:"error",fontSize:"14px",children:t.role.message})]}),M("role")=="MARKETING"&&!i&&e.jsxs(o,{item:!0,size:{xs:12,sm:6,md:4},children:[e.jsx(m,{sx:{mb:".5rem"},children:"Select Manager *"}),e.jsx(de,{width:"100%",items:i?[{value:r==null?void 0:r.fromManager,name:`${(k=r==null?void 0:r.manager)==null?void 0:k.name} (${(v=r==null?void 0:r.manager)==null?void 0:v.email})`},...y.filter(s=>s.id!==(r==null?void 0:r.fromManager)).map(s=>({value:s.id,name:`${s.name} (${s.email})`}))]:y.map(s=>({value:s.id,name:`${s.name} (${s.email})`})),value:M("managerId"),onChange:s=>z("managerId",s,{shouldValidate:!0}),onSearchChange:s=>E(s),isLoading:F,shouldBeFullwidth:!0}),e.jsx(m,{sx:{fontSize:"12px"},children:"Please enter 3 or more characters"}),t.managerId&&e.jsx(l,{color:"error",fontSize:"14px",children:t.managerId.message})]})]}),e.jsx(me,{variant:"contained",type:"submit",disabled:C||T,sx:{textTransform:"capitalize",boxShadow:"none",color:"white",mt:"1.5rem",alignSelf:"self-start","&:hover":{boxShadow:"none"}},children:"Submit"})]}):e.jsx(ne,{})]})}export{pe as default};
